{
	id: loa2_l5_castle_of_the_chaos_wizard__throne_room__stairs_to_throne_cutscene,
	controlledActions: {
		start_condition: {
			startsWithCutscene: true,
			
			type: SWITCH_CONDITION,
			
			switchConditions: [
				{
					conditionId: loa2_l5_castle_of_the_chaos_wizard__throne_room__chaos_wizard_defeated,
					executedStateName: end,
				},
				{
					conditionId: loa2_l5_castle_of_the_chaos_wizard__throne_room__boss_fight_started,
                    executedStateName: activate_force_field_attack_to_push_thorin,
				},
				{
					// default case
					executedStateName: move_thorin_to_chaos_wizard_1,
				},
			],
		},
		
		activate_force_field_attack_to_push_thorin: {
			type: EVENT,
			
            event: {
                eventType: CUTSCENE_CREATE_ATTACK, // makes a configObject create the attack
                stringValue: "cutscene_object__castle_of_the_chaos_wizard__chaos_wizard_force_field", // the unitId of the config object that has to create the attack
                
                // attack name and direction are configured in the config object (in the tiled map)
			},
			
			executes: [
                end,
			]
		},
	
		move_thorin_to_chaos_wizard_1: {
			type: MOVE,
			controlledUnitId: PLAYER,
			targetPositionRelativeToUnitId: cutscene_object__chaos_wizard_dialog__thorin_position,
			controlledUnitTarget: {x: -1, y: -3},
			
			executes: [
                move_thorin_to_chaos_wizard_2,
                stop_background_music,
                move_camera_till_freydis_is_visible,
			]
		},
		
		move_thorin_to_chaos_wizard_2: {
            type: MOVE,
            controlledUnitId: PLAYER,
			targetPositionRelativeToUnitId: cutscene_object__chaos_wizard_dialog__thorin_position,
            controlledUnitTarget: {x: 0, y: 0},
		},
		
		stop_background_music: {
			type: EVENT,
            
            event: {
                eventType: STOP_BACKGROUND_MUSIC,
                booleanValue: true, // fade out
			}
			
			executes: [
				play_chaos_wizard_music,
			]
		},
		
		play_chaos_wizard_music: {
            type: EVENT,
            
            event: {
                eventType: ADD_BACKGROUND_MUSIC_TO_QUEUE, // add to queue is needed because of the fade out of the previous music
                stringValue: chaos_wizard_intro,
                floatValue: 1f, // delay in seconds
			}
			
			executes: [
				play_chaos_wizard_music_loop,
			]
		},
		
		play_chaos_wizard_music_loop: {
            type: EVENT,
            
            event: {
                eventType: ADD_BACKGROUND_MUSIC_TO_QUEUE,
                stringValue: chaos_wizard_intro_loop,
                booleanValue: true,  // fade in
			}
		},
		
		move_camera_till_freydis_is_visible: {
			type: MOVE_CAMERA,
			targetPositionRelativeToUnitId: cutscene_object__chaos_wizard_dialog__thorin_position,
			updatePositionRelativeToTarget: true,
			controlledUnitTarget: {x: 2, y: 0},
			speedFactor: 3f,
			
			executes: [
//				change commented lines to "chaos_wizard_18" to skip the initial part of the dialog
//				chaos_wizard_18,
			    chaos_wizard__greeting,
			    chaos_wizard_evil_laugh_1,
			],
		},
		
		chaos_wizard_evil_laugh_1: {
			type: PLAY_SOUND,
			
			executionDelayInSeconds: 7f,
			
            soundEffectName: evil_laugh,
		},
		
		chaos_wizard__greeting: {
            type: SHOW_ON_SCREEN_TEXT,
            
			executionDelayInSeconds: 1f,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Thorin...                   \nAt last, you stand before me in my fortress of dread.               \nI will admit it... I am almost impressed.       \n*evil laughter*                 ",
                showNextPageIcon: true,
                canBeSkipped: false,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                thorin_1,
			],
		},
		
		thorin_1: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Thorin",
                displayText: "The Strange Chaos Wizard Guy!!!\n                 \nFinally, I can shut you up!           ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_2,
			],
		},
		
		chaos_wizard_2: {
            type: SHOW_ON_SCREEN_TEXT,
            
			executionDelayInSeconds: 0.5f,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Ah, but before you try...          \nA tragic revelation.\n                     \nYour princess is in another castle!                ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
            	thorin_2,
			],
		},
		
		thorin_2: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Thorin",
                displayText: "...                         \n...                         \nI can literally see Freydis behind that wall!          ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                freydis_1,
			],
		},
		
		freydis_1: {
			type: SHOW_ON_SCREEN_TEXT,
			
			executionDelayInSeconds: 0.5f,
			
			executionParameters: {
                displayTextHeader: "Freydis",
                colorHeader: #ff00ff,
                displayText: "Hey Thorin!                 \nTook you long enough to get here!         ",
                showNextPageIcon: true,
			}
			
			waitForEventToFinish: true,
			
			executes: [
                wait_0,
			],
		},
		
		wait_0: {
			type: WAIT,
            executionDurationInSeconds: 1f,
            
            executes: [
                chaos_wizard_looking_arround_1,
			],
		}
		
		chaos_wizard_looking_arround_1: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: 0.05, y: 0},
            
            executionDurationInSeconds: 1f,
            waitForEventToFinish: true,
            
            executes: [
                wait_1,
			],
		},
		
		wait_1: {
			type: WAIT,
            executionDurationInSeconds: 1f,
            
            executes: [
                chaos_wizard_looking_arround_2,
			],
		}
		
		chaos_wizard_looking_arround_2: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: -0.05, y: 0},
            
            executionDurationInSeconds: 1f,
            waitForEventToFinish: true,
            
            executes: [
                wait_2,
			],
		},
		
		wait_2: {
			type: WAIT,
            executionDurationInSeconds: 1f,
            
            executes: [
                chaos_wizard_looking_arround_3,
			],
		}
		
		chaos_wizard_looking_arround_3: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: 0.05, y: 0},
            
            executes: [
                wait_3,
			],
		},
		
		wait_3: {
			type: WAIT,
            executionDurationInSeconds: 0.3f,
            
            executes: [
                chaos_wizard_looking_arround_4,
			],
		}
		
		chaos_wizard_looking_arround_4: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: -0.05, y: 0},
            
            executes: [
                wait_4,
			],
		},
		
		wait_4: {
			type: WAIT,
            executionDurationInSeconds: 0.3f,
            
            executes: [
                chaos_wizard_looking_arround_5,
			],
		}
		
		chaos_wizard_looking_arround_5: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: 0.05, y: 0},
            
            executionDurationInSeconds: 2f,
            waitForEventToFinish: true,
            
            executes: [
                wait_5,
			],
		},
		
		wait_5: {
			type: WAIT,
            executionDurationInSeconds: 0.3f,
            
            executes: [
                chaos_wizard_looking_arround_6,
			],
		}
		
		chaos_wizard_looking_arround_6: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
            controlledUnitTarget: {x: -0.05, y: 0},
            
            executionDurationInSeconds: 2f,
            waitForEventToFinish: true,
            
            executes: [
                wait_6,
			],
		},
		
		wait_6: {
			type: WAIT,
            executionDurationInSeconds: 2f,
            
            executes: [
                chaos_wizard_3,
			],
		}
		
		chaos_wizard_3: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Damn 2D graphics!!!!!\n                     \n*mumbling*\nNext time I'll build a ray-caster!         ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_4,
			],
		},
		
		chaos_wizard_4: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "I mean...\n                        \nYou passed my final test, Thorin...       \nYou are indeed a worthy opponent!      ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_5,
			],
		},
		
		chaos_wizard_5: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "So I shall grant you the honor to fight me:\nThe Chaos Wizard!              \nThe Creator of this World!                 \nThe master of this Universe!            \nThe shaper of -        ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                thorin_3,
			],
		},
		
		thorin_3: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Thorin",
                displayText: "Shut up already!!!                 \nLet's get this over with, so I don't have to listen to your annoying voice any longer!         ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_6,
			],
		},
		
		chaos_wizard_6: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionDelayInSeconds: 0.5f,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "But ...                   \nI poured my soul into crafting this moment! Freydis helped me rehearse!         \nNow be silent and witness my ultimate villain speech!               ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                freydis_2,
			],
		},
		
		freydis_2: {
			type: SHOW_ON_SCREEN_TEXT,
			
			executionParameters: {
                displayTextHeader: "Freydis",
                colorHeader: #ff00ff,
                displayText: "\"Helped\"?!           \nListening to you talk to yourself for hours was torture!!!        ",
                showNextPageIcon: true,
			}
			
			waitForEventToFinish: true,
			
			executes: [
                chaos_wizard_7,
			],
		},
		
		chaos_wizard_7: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionDelayInSeconds: 0.5f,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Thank you for your feedback, Freydis!\n                   \nNow...\nWhere was I...        ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_8,
			],
		},
		
		chaos_wizard_8: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "As it was written in the ancient scrolls... also known as \"The Markup Files of Eternal Doom\"... I shaped the Nine Realms from the endless ice-shrouded abyss of Niflheim to the world-scorching flames of Muspelheim with only one goal: To rule them as their rightful, glorious, omnipotent overlord!\nTo become the one wizard to rule them all!\nAnd to finally crush the so-called \"Hero\"!!!      ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                thorin_4,
			],
		},
		
		thorin_4: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Thorin",
                displayText: "Actually, that were two goals.         ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_9,
			],
		},
		
		chaos_wizard_9: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Interrupt me again and I'll disable the skip button for this dialog!!!      ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_10,
			],
		},
		
		chaos_wizard_10: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "You really thought you stood a chance against me after you defeated one boss after another, didnâ€™t you?   ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_11,
			],
		},
		
		chaos_wizard_11: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "But you only triumphed because I allowed it!                        \nAnd now you will fail because I demand it!   ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_12,
			],
		},
		
		chaos_wizard_12: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Why else would I add an Easy Mode to the game?\nIt was all part of my plan to guide you to me! Every triumph. Every rune. Every side quest. All part of my genius design!",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_13,
			],
		},
		
		chaos_wizard_13: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "I prepared everything perfectly. My deadliest minions. An arena worthy of our legendary battle. I even borrowed the Vorpal Laserblaster of Pittenweem from a friend! All for this moment!",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_14,
			],
		},
		
		chaos_wizard_14: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "In every other world, every other stale bedtime story, the \"Hero\" wins.\n              \nBut not here! Not in a realm forged by my hand!     ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_15,
			],
		},
		
		chaos_wizard_15: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "You did a fantastic job, Thorin.\nYou believed me when I told you you were the chosen hero of this story.\nYou fought through all the side quests I made up for you.\nYou defeated every creature I created for you and found the runes that led you to me.\nOnly to be defeated now, by the almighty \"Chaos Wizard\"!!!     ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_16,
			],
		},
		
		chaos_wizard_16: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "I really enjoyed our little exchanges and quipping, Thorin. But you will not win because destiny demands it.\nYou will not win because the audience expects it.\nYou will not win because \"the hero always wins.\"\nAnd you will certainly not win because of the player's ability to press the attack button repeatedly!",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_17,
			],
		},
		
		chaos_wizard_17: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "The time has finally come, Thorin! For this is the climax foretold in the ancient \"Legend of Asamnir\"!   ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                chaos_wizard_18,
			],
		},
		
		chaos_wizard_18: {
            type: SHOW_ON_SCREEN_TEXT,
            
            executionParameters: {
                displayTextHeader: "Strange Chaos Wizard Guy",
                colorHeader: #850085,
                displayText: "Prepare yourself. For now you will face thy doom.\n                                \nAnd with it ... my unpaid interns!          \nMinions, attack!      ",
                showNextPageIcon: true,
			}
            
            waitForEventToFinish: true,
            
            executes: [
                change_traversable_object_bodies_to_sensors,
                stop_background_music_2,
			],
		},
		
		stop_background_music_2: {
            type: EVENT,
            
            event: {
                eventType: STOP_BACKGROUND_MUSIC,
                booleanValue: true, // fade out
			}
			
			executes: [
				play_boss_fight_music,
			]
		},
		
		play_boss_fight_music: {
            type: EVENT,
            
            event: {
                eventType: ADD_BACKGROUND_MUSIC_TO_QUEUE, // add to queue is needed because of the fade out of the previous music
                stringValue: boss_enraged,
                floatValue: 7f, // delay in seconds
                booleanValue: true,  // fade in
			}
		},
		
		change_traversable_object_bodies_to_sensors: {
            type: EVENT,
            
            event: {
                eventType: TRAVERSABLE_OBJECT_CHANGE_BODY_TO_SENSOR,
			}
            
            executes: [
                change_state__chaos_wizard__cast_loop,
			]
		},
		
		change_state__chaos_wizard__cast_loop: {
			type: CHANGE_STATE,
			
			executionDelayInSeconds: 1f,
			
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
			controlledUnitState: cast_loop_with_effect,
            
            executes: [
                fire_nova_attack_to_push_thorin,
			]
		},
		
		fire_nova_attack_to_push_thorin: {
			type: EVENT,
			
			executionDelayInSeconds: 1f,
            
            event: {
                eventType: CUTSCENE_CREATE_ATTACK, // makes a configObject create the attack
                stringValue: "cutscene_object__castle_of_the_chaos_wizard__chaos_wizard_push_nova", // the unitId of the config object that has to create the attack
                
                // attack name and direction are configured in the config object (in the tiled map)
			},
			
			executes: [
                change_state__chaos_wizard__idle,
			]
		},
		
		change_state__chaos_wizard__idle: {
			type: CHANGE_STATE,
			
			executionDelayInSeconds: 1f,
			
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
			controlledUnitState: idle,
            
            executes: [
                change_traversable_object_bodies_to_solid,
			]
		},
		
		change_traversable_object_bodies_to_solid: {
            type: EVENT,
            
            event: {
                eventType: TRAVERSABLE_OBJECT_CHANGE_BODY_TO_SOLID_OBJECT,
			}
            
            executes: [
            	change_state__chaos_wizard__move_with_animation,
            	spawn_elder_dragon,
			]
		},
		
		spawn_elder_dragon: {
            type: EVENT,
            
            event: {
            	eventType: CUSTCENE_SPAWN_UNIT,
            	stringValue: elder_dragon,
            }
		},
		
		change_state__chaos_wizard__move_with_animation: {
			type: CHANGE_STATE,
			
			executionDelayInSeconds: 1f,
			
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
			controlledUnitState: move_with_animation,
            
            executes: [
                move_chaos_wizard_to_second_position,
                start_boss_fight,
                move_camera_to_elder_dragon,
			]
		},
		
		move_chaos_wizard_to_second_position: {
            type: MOVE,
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
			targetPositionRelativeToUnitId: cutscene_object__chaos_wizard_dialog__chaos_wizard_second_position,
            controlledUnitTarget: {x: 0, y: 0},
            speedFactor: 2f,
            
            executes: [
                change_state__chaos_wizard__idle_2,
            ]
		},
		
		change_state__chaos_wizard__idle_2: {
			type: CHANGE_STATE,
			
			executionDelayInSeconds: 1f,
			
            controlledUnitId: loa2_l5_castle_of_the_chaos_wizard__chaos_wizard,
			controlledUnitState: idle,
		},
		
		start_boss_fight: {
			type: EVENT,
			executionDelayInSeconds: 2f,
			
			event: {
				eventType: BOSS_ENEMY_SHOW,
			},
		}
		
		move_camera_to_elder_dragon: {
            type: MOVE_CAMERA,
            targetPositionRelativeToUnitId: cutscene_object__chaos_wizard_dialog__elder_dragon_camera_position,
            updatePositionRelativeToTarget: false,
            controlledUnitTarget: {x: 0, y: 0},
            speedFactor: 2f,
            
            executes: [
                set_global_value__boss_fight_started,
			]
		},
		
		set_global_value__boss_fight_started: {
            type: EVENT,
            
            event: {
                eventType: SET_GLOBAL_CONDITION_VALUE,
                stringValue: "{key: loa2_l5_castle_of_the_chaos_wizard__throne_room__boss_fight_started, value: true}",
			},
            
            executes: [
                play_sound_effect__elder_dragon_taunt,
			]
		}
		
		play_sound_effect__elder_dragon_taunt: {
            type: PLAY_SOUND,
            
			executionDelayInSeconds: 1f,
            
            soundEffectName: elder_dragon_taunt,
            
            executes: [
                wait_before_starting_boss_fight,
            ]
		},
		
		wait_before_starting_boss_fight: {
            type: WAIT,
            
            executionDelayInSeconds: 1f,
            
            executes: [
                end,
			],
		},
		
		end: {
			type: WAIT,
			executionDelayInSeconds: 0f,
		}
	}
}